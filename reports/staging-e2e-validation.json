{
  "validation_plan": {
    "system_under_test": "Blackstar + FreeBlackMarket integration",
    "environment": "local CI container",
    "timestamp_utc": "2026-02-28T00:00:00Z",
    "scenarios": [
      {
        "id": "S1-normal-full-lifecycle",
        "description": "checkout -> delivery.option.selected -> listing created -> claim -> in_transit -> delivered",
        "status": "blocked",
        "steps": [
          {"name": "Post delivery.option.selected webhook", "status": "blocked"},
          {"name": "Verify shipment listing created", "status": "blocked"},
          {"name": "Claim listing with X-Correlation-ID", "status": "blocked"},
          {"name": "Update listing status to in_transit", "status": "blocked"},
          {"name": "Update listing status to delivered", "status": "blocked"},
          {"name": "Correlate IDs across receipt/outbound/API responses", "status": "blocked"}
        ],
        "evidence": [
          "reports/logs/scenario-normal-initial.log",
          "reports/logs/scenario-normal-rerun-after-patch.log"
        ]
      },
      {
        "id": "S2-delayed-retry",
        "description": "Outbound dispatch fails once then succeeds via retry endpoint",
        "status": "blocked",
        "steps": [
          {"name": "Create listing via webhook", "status": "blocked"},
          {"name": "Trigger claim event with initial HTTP 500", "status": "blocked"},
          {"name": "Invoke /api/webhooks/freeblackmarket/retry", "status": "blocked"},
          {"name": "Verify attempts increment and status becomes dispatched", "status": "blocked"}
        ],
        "evidence": [
          "api/tests/Feature/StagingE2EValidationTest.php"
        ]
      },
      {
        "id": "S3-cancellation-edge",
        "description": "Cancel in-transit listing from order.cancelled webhook",
        "status": "blocked",
        "steps": [
          {"name": "Create listing and claim", "status": "blocked"},
          {"name": "Set status in_transit", "status": "blocked"},
          {"name": "Post order.cancelled webhook", "status": "blocked"},
          {"name": "Verify listing cancelled and no delivered event emitted", "status": "blocked"}
        ],
        "evidence": [
          "api/tests/Feature/StagingE2EValidationTest.php"
        ]
      }
    ]
  },
  "execution": {
    "commands": [
      "cd /workspace/Blackstar/api && php artisan test --filter=test_scenario_normal_full_lifecycle_with_correlation_consistency tests/Feature/StagingE2EValidationTest.php",
      "cd /workspace/Blackstar/api && composer install --no-interaction --prefer-dist",
      "cd /workspace/Blackstar/api && composer install --no-interaction --prefer-dist --ignore-platform-reqs",
      "php -l /workspace/Blackstar/api/app/Http/Controllers/Api/ShipmentBoardListingController.php",
      "php -l /workspace/Blackstar/api/tests/Feature/StagingE2EValidationTest.php"
    ],
    "blockers": [
      "vendor dependencies unavailable in environment (no /api/vendor/autoload.php)",
      "composer dependency fetch to github blocked by CONNECT tunnel 403"
    ]
  },
  "patch_recommendations": [
    {
      "type": "implemented",
      "summary": "Add correlation_id to claim and status API JSON responses for end-to-end traceability",
      "files": ["api/app/Http/Controllers/Api/ShipmentBoardListingController.php"]
    }
  ]
}
